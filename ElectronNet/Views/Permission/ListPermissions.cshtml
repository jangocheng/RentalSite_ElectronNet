@model string
@{
    ViewData["Title"] = "权限列表";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<span class="layui-breadcrumb">
    <i class="layui-icon">&#xe68e;</i>
    <a>首页</a>
    <a>权限管理</a>
    <a>
        <cite>权限项管理</cite>
    </a>
</span>

<section class="layui-larry-box">
    <div class="layui-tab">
        <blockquote class="layui-elem-quote news_search">
            <div class="layui-inline">
                <a class="layui-btn layui-btn-normal newsAdd_btn"><i class="layui-icon">&#xe654;</i>添加权限</a>
            </div>
            <div class="layui-inline">
                <a class="layui-btn layui-btn-danger batchDel"><i class="layui-icon">&#xe640;</i>批量删除</a>
            </div>
        </blockquote>
        <table class="layui-table" id="dataTable" lay-filter="dataTable"></table>
    </div>
</section>

<script type="text/html" id="perBar">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>

@section Scripts{
    <script type="text/javascript">
        let json = JSON.parse('@Html.Raw(Model)');

        layui.use(["table", "layer"], function () {
            let table = layui.table;
            let layer = layui.layer;

            if (json.status != 200) {
                layer.open({
                    content: json.message,
                    offset: "auto",
                    btnAlign: "c"
                });
                return false;
            }

            table.render({
                elem: '#dataTable',
                height: "full-127",
                data: json.data,
                cols: [[
                    { fixed: "left", type: "checkbox" },
                    { field: 'name', title: '名称' },
                    { field: 'description', title: '描述' },
                    { fixed: "right", align: 'center', toolbar: '#perBar', title: '操作' }
                ]]
            });

            //监听工具条
            table.on('tool(dataTable)', function (obj) {
                let data = obj.data;
                if (obj.event === 'del') {
                    layer.confirm('真的删除吗？', function (index) {
                        layer.close(index);
                        $.ajax({
                            url: "/Permission/DeletePermission",
                            type: "DELETE",
                            data: { id: data.id },
                            success: function (res) {
                                layer.alert(res.message, {
                                    icon: 1,
                                    skin: 'layer-ext-moon'
                                });
                                obj.del();
                            },
                            error: function () {
                                layer.alert(responseText.Message, {
                                    icon: 2,
                                    skin: 'layer-ext-moon'
                                });
                            }
                        });
                    });
                }
                else if (obj.event === 'edit') {
                    layer.open({
                        type: 2,
                        area: ['700px', '450px'],
                        maxmin: true,
                        content: '/Permission/EditPermission?id=' + data.id,
                        id: 'EditPermission',
                        title: '编辑权限项'
                    });
                }
            });

            $(".newsAdd_btn").click(function () {
                layer.open({
                    type: 2,
                    area: ['700px', '450px'],
                    maxmin: true,
                    content: '/Permission/AddPermission',
                    id: 'AddPermission',
                    title: '添加权限项'
                });
            });
        });
    </script>
}